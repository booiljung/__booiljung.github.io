# Camera calibration

일부 핀홀 카메라는 이미지에 심각한 왜곡을 일으킵니다. 왜곡의 주요 두 가지는 방사형 왜곡과 접선 왜곡입니다.

방사형 왜곡으로 인해 직선이 곡선으로 나타납니다. 방사형 왜곡은 이미지의 중심에서 멀어질수록 커집니다. 예를 들어, 체스 판의 두 가장자리가 빨간색 선으로 표시된 하나의 이미지가 아래에 나와 있습니다. 그런데 체스판의 테두리가 직선이 아니고 빨간선과 맞지 않는 것을 알 수 있습니다. 예상되는 모든 직선이 돌출되어 있습니다. 자세한 내용은 왜곡(광학)을 참조하십시오.

![calib_radial.jpg](https://docs.opencv.org/4.5.2/calib_radial.jpg)

방사형 왜곡:
$$
\begin{aligned}
x_\text{distored} &= x (1 + k_1 r^2 + k_2 r^4 + k_3 r^6)
\\
y_\text{distored} &= y (1 + k_1 r^2 + k_2 r^4 + k_3 r^6)
\end{aligned}
$$
접선 왜곡은 촬영 렌즈가 이미징 평면과 완벽하게 평행하게 정렬되지 않았기 때문에 발생합니다. 이미지의 일부 영역이 예상보다 가깝게 보일 수 있습니다.

접선 왜곡의 양:
$$
\begin{aligned}
x_\text{distored} &= x + \left[2p_1 xy + p_2 (r^2 + 2x^2) \right]
\\
y_\text{distored} &= y + \left[p_1 (r^2 + 2y^2) + 2p_2xy \right]
\end{aligned}
$$
왜곡 계수:

$$
\begin{pmatrix}
k_1 & k_2 & p_1 & p_2 & k_3
\end{pmatrix}
$$
이 외에도 카메라의 내부 및 외부 매개변수와 같은 다른 정보가 필요합니다. 내부 매개변수는 카메라에 따라 다릅니다. 여기에는 focal length $(f_x, f_y)$ 및 optical center $(c_x, c_y)$과 같은 정보가 포함 된다. 초점 거리와 광학 중심을 사용하여 특정 카메라의 렌즈로 인한 왜곡을 제거하는 데 사용할 수 있는 카메라 행렬을 만들 수 있습니다. 카메라 행렬은 특정 카메라에 고유하므로 한 번 계산되면 동일한 카메라로 촬영한 다른 이미지에 재사용할 수 있습니다. 카메라 행렬은 3x3 행렬로 표현 됩니다.

카메라 행렬:
$$
\begin{bmatrix}
f_x & 0 & c_x \\
0 & f_y & c_y \\
0 & 0 & 1 \\
\end{bmatrix}
$$
외부 매개변수는 3D 점의 좌표를 좌표계로 변환하는 회전 및 변환 벡터에 해당합니다.

스테레오 응용 프로그램의 경우 이러한 왜곡을 먼저 수정해야 합니다. 이러한 매개변수를 찾으려면 잘 정의된 패턴(예: 체스 판)의 샘플 이미지를 제공해야 합니다. 우리는 이미 상대 위치를 알고 있는 특정 지점을 찾습니다(예: 체스 판의 정사각형 모서리). 우리는 실제 공간에서 이러한 점의 좌표를 알고 이미지의 좌표를 알고 있으므로 왜곡 계수를 해결할 수 있습니다. 더 나은 결과를 얻으려면 최소 10개의 테스트 패턴이 필요합니다.

이제 단위 변환을 위해 다음 공식을 사용합니다:
$$
\begin{bmatrix}
x \\
y \\
w \\
\end{bmatrix}
=
\begin{bmatrix}
f_x & 0 & c_x \\
0 & f_y & c_y \\
0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
X \\
Y \\
Z \\
\end{bmatrix}
$$
여기서 $w$의 존재는 동차 좌표계의 사용으로 설명됩니다 (그리고 $w=Z$). 알 수 없는 매개변수는 카메라 초점 거리인 $f_x$ 및 $f_y$ 그리고 픽셀 좌표로 표시되는 광학 중심인  $c_x, c_y$입니다. 두 축에 대해 공통 초점 길이가 주어진 종횡비(보통 1)와 함께 사용되면 $f_y=f_x*a$이고 위 공식에서 단일 초점 길이 $f$를 갖게 됩니다. 이 네 가지 매개변수를 포함하는 행렬을 카메라 행렬이라고 합니다. 왜곡 계수는 사용된 카메라 해상도에 관계없이 동일하지만 보정된 해상도의 현재 해상도와 함께 조정되어야 합니다.

이 두 행렬을 결정하는 과정이 보정입니다. 이러한 매개변수의 계산은 기본 기하학적 방정식을 통해 수행됩니다. 사용된 방정식은 선택한 보정 대상에 따라 다릅니다. 현재 OpenCV는 보정을 위해 세 가지 유형의 개체를 지원합니다.

- 고전적인 흑백 체스판
- 대칭 원형 패턴
- 비대칭 원형 패턴

기본적으로 카메라로 이러한 패턴의 스냅샷을 찍어 OpenCV가 찾도록 해야 합니다. 발견된 각 패턴은 새로운 방정식을 생성합니다. 방정식을 풀려면 올바른 방정식 시스템을 형성하기 위해 최소한 미리 결정된 수의 패턴 스냅샷이 필요합니다. 이 숫자는 체스판 패턴의 경우 더 높고 원형 패턴의 경우 더 적습니다. 예를 들어, 이론상 체스판 패턴에는 최소 두 개의 스냅샷이 필요합니다. 그러나 실제로는 입력 이미지에 상당한 양의 노이즈가 있으므로 좋은 결과를 얻으려면 다른 위치에 있는 입력 패턴의 좋은 스냅샷이 10개 이상 필요할 것입니다.

